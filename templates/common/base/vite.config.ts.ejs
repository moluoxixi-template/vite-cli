import path from 'node:path'
import process from 'node:process'
import cssModuleGlobalRootPlugin from '@moluoxixi/css-module-global-root-plugin'
import { ViteConfig, wrapperEnv } from '@moluoxixi/vite-config'
import { loadEnv } from 'vite'
<%- imports %>

export default ViteConfig(
  ({ mode }) => {
    const env = loadEnv(mode!, process.cwd())
    const viteEnv = wrapperEnv(env)
    const rootPath = path.resolve()
    const appCode = viteEnv.VITE_APP_CODE
    const appTitle = viteEnv.VITE_APP_TITLE
    const port = viteEnv.VITE_APP_PORT

    return {
      rootPath,
      appTitle,
      appCode,
      port,
      <%- topLevelConfig %>,
      viteConfig: {
        plugins: [ <%- plugins.join(',\n          ') %> ],
        <%- mergedConfigBody %>
      },
    }
  },
)

